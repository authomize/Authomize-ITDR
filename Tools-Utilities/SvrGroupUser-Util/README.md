``` Authomize Remote Server Group User Utility [Release - 1.0] 10-31-23```

### Getting Started

- Download the Open-ITDR GitHub Repo & ensure the SvrGroupUser-Util folder is in the desired working directory. 
- Clone the repository into a working directory, by using git clone like the following:

	-  `git clone https://https://github.com/authomize/Open-ITDR/tree/main`

- You can delete all other directory structures, you only need `https://github.com/authomize/Open-ITDR/tree/main/Tools-Utilities/SvrGroupUser-Util` 

- Alternatively just manually download the required files by clicking on the raw download link top right in the github location.

## Required Permissions and Actions: 
- Active Directory permissions: The script needs permissions to query WinRM [WMI] remote interface on each server. This usually is an administrative account on the Server.
- Filesystem permissions: The script writes logs to a file ($logFilePath). The account running the script should have permission to create and write to the specified log file.
- PowerShell execution policy: To run the script, the PowerShell execution policy on the machine should be configured to allow running scripts. 
- The easiest way to enable remote execution: On the remote server start a powershell script using the run as administrator command. From within the power shell script run the cmdlet `Enable-PSRemoting -Force` . See [ENable-PSRemoting](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.3) for more details.


## Additional Powershell Modules
- No additional modules are required
- Version `7.3.9.0` of powershell or above is required

## Configure the script to run
- Locate the file `ServerNames.txt` Enter the names or ip addresses followed by a comma as follows in the file (keep this file in the same director as the script)
	- `Example1, Example2, Example3, 10.10.10.5`
- Manual script execution is possible from within powershell `./groupmembers-r1.ps1` . 

*NOTE:* The script will run in the currently logged in user security context.

## Use Windows Task Scheduler to Schedule groupmembers-r1.ps1
- Set the script to run on a 12 hour schedule
- For help with this refer to [Task Scheduler](https://learn.microsoft.com/en-us/windows/win32/taskschd/using-the-task-scheduler) information from microsoft
- Ensure you use a domain user with access to the servers you are taregting

## The Script Gathers the Below Information from each Server
- All users associated with the Local Administrators group
- Domain Groups associated with the local Administrators group
- User Administrator's
- User Domain Administrators with access to the Server

## Executing the PowerShell Script ##
- A file called `CollectionLog.txt` is created to store log messages in the current directory
- A directory is created called `JSONProcessing`
	- Files are created in this directory with a datetime stamp and servername
	- A file is created for each server that we connect to
- The following JSON example is generated by this script:
```[

  {

    "GroupComponent": "Win32_Group (Domain = \"DESKTOP-JHTU9DG\", Name = \"Administrators\")",

    "PartComponent": "Win32_UserAccount (Domain = \"DESKTOP-JHTU9DG\", Name = \"Administrator\")",

    "PSComputerName": "DESKTOP-JHTU9DG"

  },
  {

    "GroupComponent": "Win32_Group (Domain = \"DESKTOP-JHTU9DG\", Name = \"Administrators\")",

    "PartComponent": "Win32_UserAccount (Domain = \"DESKTOP-JHTU9DG\", Name = \"sriley\")",

    "PSComputerName": "DESKTOP-JHTU9DG"

  },
  {

    "GroupComponent": "Win32_Group (Domain = \"DESKTOP-JHTU9DG\", Name = \"Administrators\")",

    "PartComponent": "Win32_Group (Domain = \"MYTEST\", Name = \"Domain Admins\")",

    "PSComputerName": "DESKTOP-JHTU9DG"
  }
]
```

## Hints & Other Info
- A log file is created in the same directory as the script indicating success and errors if any for each server connected to.
- The log file does *NOT* overwrite itself. Check this file periodically for size.

